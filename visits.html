<html>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NDG392MCRE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-NDG392MCRE');
</script>  
<style>
@import url('https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap');
/* Center child elements */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Montserrat', sans-serif;
}
body,
.website-counter {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  background-color: #648FFF;
  color: white;
}
body {
  height: 100vh;
}
/* Styles for website counter container */
.website-counter {
  background-color: #DC267F;
  height: 50px;
  width: 80px;
  color: white;
  border-radius: 30px;
  font-weight: 700;
  font-size: 25px;
  margin-top: 10px;
}
</style>
  <head>
    <title>Website Counter</title>
<!--     <script defer src="index.js"></script>
    <link rel="stylesheet" href="styles.css" /> -->
  </head>
  <body>
    <div>Website Visit Count:</div>
    <div class="website-counter"></div>
  </body>

<script>

  // Variable that contains the website counter
  var counterContainer = document.querySelector(".website-counter");

  // URL contains Cloudflare worker function where we want to fetch data from
  var url = 'https://unique-visitors.pebbleparadisepeople.workers.dev/';
  
  // Collect user's data and store it into "info"
  document.addEventListener("DOMContentLoaded", function(){
    const info = {   browserLang: navigator.browserLanguage,
                     language: navigator.language,
                     platform: navigator.platform,
                     connectionSpeed: navigator.connectionSpeed,
                     userAgent: navigator.UserAgent,
                     webdriver: navigator.webdriver,
                     geolocation: navigator.geolocation
                  } 

    // Talk to Cloudflare Worker function
    // Once the info from the user is obtained, send the data to the worker function
    // so that the worker function can store it into the database if it is different
    // from any previous info entry or do nothing if it is the same
    fetch(url, {
      method: 'POST',
      headers: {
      'Content-Type': 'application/json'
      },
      body: JSON.stringify(info)                   
    }) // end fetch
      
  }) //end document.addEventListener
                            
  // Fetch the content of the Cloudflare Worker function
  // When the url of the Cloudflare Worker function is visited
  // there is a number (the number of unique visitors we have registered in our database)
  // This code gets that number so that it can be displayed on visits.html
  fetch(url)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.text();
    })
    .then(data => {
      // Display the content on the page
      counterContainer.innerHTML = data; // Assuming the response is a string
    })
    .catch(error => {
      console.error('Fetch error:', error);
      counterContainer.innerHTML = 'Error loading data'; // Display an error message
    });

</script>
</html>
